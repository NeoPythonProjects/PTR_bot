SELECT p.lob, p.tradecode, p.uy, sub.dev_q, p.gwp_, sub.incd, i.ieulr, pat.FTU, sub.incd*pat.ftu as bcl, sub.incd + ((1-(1/pat.ftu)) * i.ieulr * p.gwp_) as bf 
  FROM (SELECT p.lob, p.tradecode, p.uy, SUM(p.gwp) as gwp_ FROM premium as p 
  WHERE p.lob='Onshore' AND p.tradecode='tr9'
  GROUP BY p.lob, p.tradecode, p.uy
  ) as p
  INNER JOIN (SELECT c.lob, c.tradecode, c.uy, c.paid, c.case_, c.paid+c.case_ as incd, c.dev_q FROM claims as c 
  WHERE c.lob='Onshore' AND c.tradecode='tr9'  
  GROUP BY c.lob, c.tradecode, c.uy 
  ) as sub ON p.tradecode=sub.tradecode AND p.lob=sub.lob AND p.uy=sub.uy
  INNER JOIN ieulrs as i ON sub.uy = i.uy AND sub.lob = i.lob 
  INNER JOIN patterns as pat ON sub.dev_q = pat.dev and sub.lob = pat.lob
  
('Onshore', 'tr9', 2004, 72, 5846961.120000001, 5223586.0, 0.55, 1.0, 5223586.0, 5223586.0)
('Onshore', 'tr9', 2005, 68, 6395963.53, 4608462.0, 0.56, 1.0, 4608462.0, 4608462.0)
('Onshore', 'tr9', 2006, 64, 6746873.09, 4324466.0, 0.63, 1.0, 4324466.0, 4324466.0)
('Onshore', 'tr9', 2007, 60, 6388536.0699999975, 5190416.0, 0.36, 1.0, 5190416.0, 5190416.0)
('Onshore', 'tr9', 2008, 56, 5425129.570000001, 3515436.0, 0.59, 1.0, 3515436.0, 3515436.0)
('Onshore', 'tr9', 2009, 52, 6681427.410000002, 4778555.0, 0.51, 1.0, 4778555.0, 4778555.0)
('Onshore', 'tr9', 2010, 48, 5705672.330000001, 5497372.0, 0.65, 1.0, 5497372.0, 5497372.0)
('Onshore', 'tr9', 2011, 44, 6660275.520000001, 6689245.0, 0.38, 1.0, 6689245.0, 6689245.0)
('Onshore', 'tr9', 2012, 40, 6910503.850000003, 5890083.0, 0.5, 1.0, 5890083.0, 5890083.0)
('Onshore', 'tr9', 2013, 36, 7279186.920000003, 6129798.0, 0.64, 1.0, 6129798.0, 6129798.0)
('Onshore', 'tr9', 2014, 32, 5633737.0600000005, 2324375.0, 0.52, 1.0, 2324375.0, 2324375.0)
('Onshore', 'tr9', 2015, 28, 6935083.300000002, 8408772.0, 0.4, 1.6, 13454035.200000001, 9449034.495000001)
('Onshore', 'tr9', 2016, 24, 6137900.330000001, 3008557.0, 0.53, 2.5, 7521392.5, 4960409.30494)
('Onshore', 'tr9', 2017, 20, 6171993.3500000015, 7394496.0, 0.57, 3.2, 23662387.200000003, 9813145.89403125)
('Onshore', 'tr9', 2018, 16, 7028484.440000002, 981489.0, 0.45, 3.5, 3435211.5, 3240644.712857144)
('Onshore', 'tr9', 2019, 12, 5846172.640000001, 5673743.0, 0.58, 4.1, 23262346.299999997, 8237503.587004878)
('Onshore', 'tr9', 2020, 8, 6187921.560000002, 3285854.0, 0.64, 4.5, 14786343.0, 6366063.843200002)
('Onshore', 'tr9', 2021, 4, 5870085.080000002, 4579574.0, 0.47, 5.3, 24271742.2, 6817959.272958491)
